const CALL="CALL",PUT="PUT",NO_OF_STRIKE=10,HIGHLIGHT_STRIKE=5,SHOW_LTP=!0;let viewMode="ltp",optionChainPrice={},ticker="TICKER",strikeDiff=0,priceRange=[0,0],highlightStrike=[0,0],oldOIDiff=1e7,oldOIDiffRange=1e7,columnIndex={},totalColLength=0,strikePriceOrder={};function updateChipsHawa(){var i,t=getTicker();if(!t||ticker!=t)return ticker=t,optionChainPrice={},strikeDiff=0,void(oldOIDiff=0);let x=getFuturePrice();if(x){let{callCol:d,putCol:C,strikeCol:u,callOICol:v,putOICol:g}=getColumnPosition();updateTableHeader(d,C,u),0===strikeDiff&&(strikeDiff=getStrikeDiff(u),i=$("#current-atm-row").find(`div.rt-td:nth-child(${u})`).find("span").text().trim(),i=parseInt(i),priceRange[0]=i-NO_OF_STRIKE*strikeDiff,priceRange[1]=i+NO_OF_STRIKE*strikeDiff,highlightStrike[0]=i-HIGHLIGHT_STRIKE*strikeDiff,highlightStrike[1]=i+HIGHLIGHT_STRIKE*strikeDiff);let w=0,f=0,P=0,m=0;$(".chips-hawa-highlight").removeClass("chips-hawa-highlight"),$("#oc-table-body div.rt-tr-group").each((i,t)=>{let a=$(t),e=a.find(`.rt-tr div.rt-td:nth-child(${u})`),r=a.find(`.rt-tr div.rt-td:nth-child(${d})`),o=a.find(`.rt-tr div.rt-td:nth-child(${C})`),n=a.find(`.rt-tr div.rt-td:nth-child(${v})`),l=a.find(`.rt-tr div.rt-td:nth-child(${g})`);var s=e.find("span").text().trim(),c=(s=parseInt(s))+"-"+CALL,p=s+"-"+PUT;optionChainPrice[c]||(optionChainPrice[c]={},optionChainPrice[p]={},optionChainPrice[c].chips=-1,optionChainPrice[c].hawa=-1,optionChainPrice[p].chips=-1,optionChainPrice[p].hawa=-1,optionChainPrice[c].oi=0,optionChainPrice[p].oi=0,optionChainPrice[c].pcr="0",optionChainPrice[p].pcr="0"),0==a.find("div.chips-hawa-price").length&&(r.prepend("<div class='chips-hawa-price chips'>0</div>"),r.append("<div class='chips-hawa-price hawa'>0</div>"),o.prepend("<div class='chips-hawa-price chips'>0</div>"),o.append("<div class='chips-hawa-price hawa'>0</div>"));var h=r.find(".MuiBox-root").text().split(" ")[0],t=(parseFloat(h).toFixed(2),o.find(".MuiBox-root").text().split(" ")[0]),h=(parseFloat(t).toFixed(2),n.find("div[class*='style__OiprogressBarValue']").text().trim()),t=l.find("div[class*='style__OiprogressBarValue']").text().trim();renderAndUpdateGlobalState(s,x,h,r,CALL),renderAndUpdateGlobalState(s,x,t,o,PUT),udpateStrikePCR(p,c,e),s>=priceRange[0]&&s<=priceRange[1]&&(P+=optionChainPrice[c].oi,m+=optionChainPrice[p].oi),highlightStrike[0]!=s&&highlightStrike[1]!=s||highlightRow(e),w+=optionChainPrice[c].oi,f+=optionChainPrice[p].oi}),$(".chips-hawa-cards.cards.oi").hasClass("hide")||(i=f-w,oldOIDiff!=i&&(renderOIChange(w,f,P,m),oldOIDiff=i))}}function highlightRow(i){i.closest(".rt-tr").find(".rt-td").addClass("chips-hawa-highlight")}function highlightCell(i,t,a=null){a=a||"chips-hawa-highlight-cell",$row=$(`#oc-table-body div.rt-tr-group:nth-child(${i}) .rt-tr div.rt-td:nth-child(${t})`).addClass(a)}function updateTableHeader(i,t,a){0==$("#oc-table-head .chips-hawa-price").length&&($(`#oc-table-head .rt-tr>div:nth-child(${i})`).prepend("<div class='chips-hawa-price chips'>CHIPS</div>"),$(`#oc-table-head .rt-tr>div:nth-child(${i})`).append("<div class='chips-hawa-price hawa'>HAWA</div>"),$(`#oc-table-head .rt-tr>div:nth-child(${t})`).prepend("<div class='chips-hawa-price chips'>CHIPS</div>"),$(`#oc-table-head .rt-tr>div:nth-child(${t})`).append("<div class='chips-hawa-price hawa'>HAWA</div>"),$(`#oc-table-head .rt-tr>div:nth-child(${a})`).append("<div class='chips-hawa-pcr-ratio'>PCR</div>"),$(`#oc-table-head .rt-tr>div:nth-child(${a})`).prepend("<div class='chips-hawa-pcr-ratio p-hawa'>%Hawa</div>"))}function getColumnPosition(){if(columns=$("#oc-table-head .rt-tr>div").length,columnIndex.length&&columns==totalColLength)return columnIndex;clearChipsHawaLabels(),totalColLength=columns;let e={};return $("#oc-table-head .rt-tr>div").each((i,t)=>{let a=$(t).text().replace(/\s/g,"").toLowerCase();a.includes("oi-lakh")&&(e.callOICol?e.putOICol=i+1:e.callOICol=i+1),a.includes("ltp(chg%)")&&(e.callCol?e.putCol=i+1:e.callCol=i+1),a.includes("strike")&&(e.strikeCol=i+1),a.includes("volume")&&(e.callVolume?e.putVolume=i+1:e.callVolume=i+1),a.includes("delta")&&(e.callDelta?e.putDelta=i+1:e.callDelta=i+1),"oichange"===a&&(e.callOIChange?e.putOIChange=i+1:e.callOIChange=i+1)}),columnIndex=e,e}function getTicker(){let i=new URLSearchParams(window.location.search);return i.has("tradingsymbol")?i.get("tradingsymbol"):null}function udpateStrikePCR(i,t,a){let e=optionChainPrice[t].percentageHawa;0==e&&(e=optionChainPrice[i].percentageHawa),a.find(".chips-hawa-pcr-ratio.p-hawa").length?a.find(".chips-hawa-pcr-ratio.p-hawa").text(parseFloat(e).toFixed(2)+"%"):a.prepend(`<div class='chips-hawa-pcr-ratio p-hawa'>${parseFloat(e).toFixed(2)}%</div>`);let r="-n/a-";0!=optionChainPrice[i].oi&&0!=optionChainPrice[t].oi&&(r=parseFloat(optionChainPrice[i].oi/optionChainPrice[t].oi).toFixed(2)),r!==optionChainPrice[i].pcr&&(optionChainPrice[i].pcr=r,optionChainPrice[t].pcr=r,a.find(".chips-hawa-pcr-ratio.pcr").length?a.find(".chips-hawa-pcr-ratio.pcr").text(r):a.append(`<div class='chips-hawa-pcr-ratio pcr'>${r}</div>`))}function renderOIChange(i,t,a,e){$OICard=$(".chips-hawa-cards.cards.oi");var r=e-a;$OICard.find(".diff_item").text(`${parseFloat(e).toFixed(2)} - ${parseFloat(a).toFixed(2)}
	= ${parseFloat(r).toFixed(2)}L (PCR: ${parseFloat(e/a).toFixed(2)})`),r<0?($OICard.find(".card").removeClass("card-4").addClass("card-5"),$OICard.find(".card .sentiments").text("Bearish Sentiments")):($OICard.find(".card").removeClass("card-5").addClass("card-4"),$OICard.find(".card .sentiments").text("Bullish Sentiments")),$OICard.find(".all-oi").text(`Over all OI diff: ${parseFloat(t).toFixed(2)} - ${parseFloat(i).toFixed(2)} 
	= ${parseFloat(t-i).toFixed(2)}L (PCR: ${parseFloat(t/i).toFixed(2)})`)}function renderAndUpdateGlobalState(i,t,a,e,r){var o=e.find(".MuiBox-root").text().split(" ")[0].replace(/\,/g,""),o=parseFloat(o).toFixed(2);[chips,hawa]=getChipsHawa(t,i,o,r);r=i+"-"+r;isNumeric(a=a.split("\n")[0])||(a=0),optionChainPrice[r].oi=parseFloat(a),optionChainPrice[r].chips===chips&&optionChainPrice[r].hawa===hawa||(e.find("div.chips-hawa-price.chips").text(chips),e.find("div.chips-hawa-price.hawa").text(hawa)),optionChainPrice[r].chips=chips,optionChainPrice[r].hawa=hawa,0!=chips?optionChainPrice[r].percentageHawa=hawa/o*100:optionChainPrice[r].percentageHawa=0}function clearChipsHawaLabels(){$("#oc-table-body div.chips-hawa-price").remove(),$("#oc-table-body div.chips-hawa-pcr-ratio").remove(),optionChainPrice={}}function getFuturePrice(){if($("[class^=style__TickerButtonText]").length){var i=$("[class^=style__TickerButtonText]").contents().filter(function(){return 3===this.nodeType})[2].textContent;return parseFloat(i)}return!1}function getChipsHawa(i,t,a,e){let r=0,o=0;return 0==a||"NaN"===a||(e===CALL?r=t<i?(o=i-t,a-o):a:e===PUT&&(r=i<t?(o=t-i,a-o):a),o=parseFloat(o).toFixed(2),r=parseFloat(r).toFixed(2)),[o,r]}function getStrikeDiff(i){let t=$(`#oc-table-body div.rt-tr-group:nth-child(1) .rt-tr div.rt-td:nth-child(${i})`);var a=t.find("span").text().trim();let e=$(`#oc-table-body div.rt-tr-group:nth-child(2) .rt-tr div.rt-td:nth-child(${i})`);i=e.find("span").text().trim();return parseFloat(i)-parseFloat(a)}function initMenuBar(){$("body").append(`
		<div class="chips-hawa-cards cards hide oi">
			<div class="card">
				<button type="button"></button>
				<h2 class="card__title">Difference between OI PE-CE</h2>
				<p class="card__title diff_item">-</p>
				<small><sup>*</sup>10 strike above and below ATM (OI in Lakh)</small>
				<p class="sentiments">-</p>
				<small class="all-oi">-</small>
			</div>
		</div>
		<div class="chips-hawa-cards cards hide settings">
			<div class="card">
				<button type="button"></button>
				<h3>Display Settings</h3>
				<label><input type="radio" name="view" value="chips"/>Chips Hawa</label>
				<label><input type="radio" name="view" value="ltp" checked/>Dad's View</label>
			</div>
		</div>
		<div class="chips-hawa-menu">
			<a class="active oi" href="#chips-hawa-oi"><span>OI</span></a>
			<a class="active settings" href="#chips-hawa-setting"><span>⚙</span></a>
		</div>
		<div class="chips-hawa-overlay hide">
			<div class="chips-hawa-ltp-content">
				<h4>LTP Calculator</h4>
				<div class="chips-hawa-ltp-body chips-hawa-clearfix">
					<div class="chips-hawa-ltp-params">
						<div class="ltp-params-item spot">
							<span	class="key">Spot : </span>
							<span	class="value"></span>
						</div>
						<div class="ltp-params-item direction">
							<span	class="key">Direction : </span>
							<span	class="value"></span>
						</div>
						<div class="ltp-params-item ce-price">
							<span	class="key">CE Ltp : </span>
							<span	class="value"></span>
						</div>
						<div class="ltp-params-item ce-delta">
							<span	class="key">CE Delta : </span>
							<span	class="value"></span>
						</div>
						<div class="ltp-params-item pe-price">
							<span	class="key">PE Ltp : </span>
							<span	class="value"></span>
						</div>
						<div class="ltp-params-item pe-delta">
							<span	class="key">PE Delta : </span>
							<span	class="value"></span>
						</div>
						<div class="ltp-params-item strike">
							<span	class="key">Strike : </span>
							<span	class="value"></span>
						</div>
					</div>
					<div class="chips-hawa-ltp-output">
						<span	class="output-price">--</span>
						<span	class="output-sl">--</span>
					</div>
				</div>
			</div>
		</div>
		<div class="chips-hawa-buttons-call"></div>
		<div class="chips-hawa-buttons-put"></div>
	`),$(".chips-hawa-cards.cards.oi button, .chips-hawa-menu a.oi").on("click",i=>{i.preventDefault(),i.stopPropagation(),$(".chips-hawa-cards.cards.oi").toggleClass("hide")}),$(".chips-hawa-cards.cards.settings button, .chips-hawa-menu a.settings").on("click",i=>{i.preventDefault(),i.stopPropagation(),$(".chips-hawa-cards.cards.settings").toggleClass("hide")}),$("input[name=view]").on("change",i=>{var t=$("input[name=view]:checked").val();viewMode!=t&&resetView(viewMode),viewMode=t}),$(".chips-hawa-overlay").on("click",i=>{i.preventDefault(),i.stopPropagation(),$(".chips-hawa-overlay").addClass("hide")}),$(".chips-hawa-ltp-content").on("click",i=>{i.preventDefault(),i.stopPropagation()})}function registerLtpEvents(){$("#oc-table-body").on("click","button.chips-hawa-ltp-trigger",i=>{i.preventDefault(),i.stopPropagation(),$(".chips-hawa-overlay").removeClass("hide")})}function ltpCalculator(i,t,a,e,r,o,n){let l=0;var s=getFuturePrice();l="error"==i?"No Pair Data":"Bullish"==i?($(".chips-hawa-ltp-output").addClass("bearish"),parseFloat(e)<parseFloat(t)?"Breakout":(l=s+(parseFloat(e)-parseFloat(t))/(a+r)+.05,isNumeric(parseFloat(l).toFixed(2))?parseFloat(l).toFixed(2):"Data Error")):($(".chips-hawa-ltp-output").removeClass("bearish"),parseFloat(t)<parseFloat(e)?"Breakdown":(l=s-(parseFloat(t)-parseFloat(e))/(a+r)-.05,isNumeric(parseFloat(l).toFixed(2))?parseFloat(l).toFixed(2):"Data Error")),$(".ltp-params-item.spot .value").text(s),$(".ltp-params-item.direction .value").text(i),$(".ltp-params-item.ce-price .value").text(t),$(".ltp-params-item.ce-delta .value").text(a),$(".ltp-params-item.pe-price .value").text(e),$(".ltp-params-item.pe-delta .value").text(r),$(".ltp-params-item.strike .value").text(o),$(".chips-hawa-ltp-output .output-price").text(l),$(".chips-hawa-ltp-output .output-sl").text("SL-"+n),showLTPOverlay()}function ltpCalculatorUI(i){i.preventDefault(),i.stopPropagation();let t=$(i.target);var a=t.data("strikecol"),i=t.data("type");let e=t.closest(".rt-tr").find(`div.rt-td:nth-child(${a})`);a=parseFloat(e.find("span").text().trim()).toFixed(2)+"-"+i,a=optionChainPrice[a];let r=a.strike+"-CALL",o=strikePriceOrder[a.index-1]+"-PUT",n=parseInt(optionChainPrice[o].strike,10)-1,l="Bearish";"CALL"==i&&(o=a.strike+"-PUT",r=strikePriceOrder[a.index+1]+"-CALL",n=parseInt(optionChainPrice[r].strike,10)+1,l="Bullish"),optionChainPrice[o]&&optionChainPrice[r]?(callOptionData=optionChainPrice[r],putOptionData=optionChainPrice[o],ltpCalculator(l,callOptionData.price,callOptionData.delta,putOptionData.price,putOptionData.delta,a.strike,n)):ltpCalculator("error",0,0,0,0,a.strike,n)}function showLTPOverlay(){$(".chips-hawa-overlay").removeClass("hide")}function resetView(i){$container=$("#tableContainer"),"chips"==i?($("body").removeClass("chips-hawa-nk"),$("body").addClass("chips-hawa-ltp"),$container.find("div.chips-hawa-price").remove(),$container.find("div.chips-hawa-pcr-ratio").remove(),$container.find(".rt-td.chips-hawa-highlight").removeClass("chips-hawa-highlight"),optionChainPrice={},registerLtpEvents()):"ltp"==i&&($("body").removeClass("chips-hawa-ltp"),$("body").addClass("chips-hawa-nk"),$container.find(".chips-hawa-highlight-cell").removeClass("chips-hawa-highlight-cell"),$container.find(".chips-hawa-imaginary-line").removeClass("chips-hawa-imaginary-line"),$container.find(".chips-hawa-highlight-int-cell").removeClass("chips-hawa-highlight-int-cell"),$container.find("div.chips-hawa-oi-ratio").remove(),$(".chips-hawa-ltp-trigger").remove(),$(".chips-hawa-error").remove(),optionChainPrice={},strikePriceOrder={})}function isNumeric(i){return"string"==typeof i&&(!isNaN(i)&&!isNaN(parseFloat(i)))}function updateLTP(){var s=getTicker();if(!s||ticker!=s)return ticker=s,optionChainPrice={},strikeDiff=0,oldOIDiff=0,void resetView("ltp");let x=getFuturePrice();if(x){let m=getColumnPosition();if(m.callVolume&&m.putVolume&&m.callDelta&&m.putDelta&&m.callOIChange&&m.putOIChange){$(".chips-hawa-error").remove(),0===strikeDiff&&(strikeDiff=getStrikeDiff(m.strikeCol));let P=[0,0];$("#oc-table-body div.rt-tr-group").each((i,t)=>{let a=$(t),e=a.find(`.rt-tr div.rt-td:nth-child(${m.strikeCol})`),r=a.find(`.rt-tr div.rt-td:nth-child(${m.callCol})`),o=a.find(`.rt-tr div.rt-td:nth-child(${m.putCol})`),n=a.find(`.rt-tr div.rt-td:nth-child(${m.callOICol})`),l=a.find(`.rt-tr div.rt-td:nth-child(${m.putOICol})`),s=a.find(`.rt-tr div.rt-td:nth-child(${m.putVolume})`),c=a.find(`.rt-tr div.rt-td:nth-child(${m.callVolume})`),p=a.find(`.rt-tr div.rt-td:nth-child(${m.callDelta})`),h=a.find(`.rt-tr div.rt-td:nth-child(${m.putDelta})`),d=a.find(`.rt-tr div.rt-td:nth-child(${m.callOIChange})`),C=a.find(`.rt-tr div.rt-td:nth-child(${m.putOIChange})`);var u=e.find("span").text().trim(),u=parseFloat(u).toFixed(2),v=(strikePriceOrder[i+1]=u)+"-"+CALL,g=u+"-"+PUT;optionChainPrice[v]||(optionChainPrice[v]={},optionChainPrice[g]={},optionChainPrice[v].index=i+1,optionChainPrice[g].index=i+1,optionChainPrice[v].strike=u,optionChainPrice[g].strike=u);t=r.find(".MuiBox-root").text().split(" ")[0],t=parseFloat(t).toFixed(2);optionChainPrice[v].price=t;t=o.find(".MuiBox-root").text().split(" ")[0],t=parseFloat(t).toFixed(2);optionChainPrice[g].price=t;t=n.find("div[class*='style__OiprogressBarValue']").text().trim();optionChainPrice[v].oi=isNumeric(t)?parseFloat(t):0;t=l.find("div[class*='style__OiprogressBarValue']").text().trim();optionChainPrice[g].oi=isNumeric(t)?parseFloat(t):0;t=c.text().trim();optionChainPrice[v].volume=isNumeric(t)?parseFloat(t):0;t=s.text().trim();optionChainPrice[g].volume=isNumeric(t)?parseFloat(t):0;t=p.text().trim();optionChainPrice[v].delta=isNumeric(t)?parseFloat(t):0;t=h.text().trim();optionChainPrice[g].delta=isNumeric(t)?-1*parseFloat(t):0;t=d.text().trim().replace("%","");optionChainPrice[v].oiChange=isNumeric(t)?parseFloat(t):0;t=C.text().trim().replace("%","");optionChainPrice[g].oiChange=isNumeric(t)?parseFloat(t):0;var w,v=optionChainPrice[v].oiChange,g=optionChainPrice[g].oiChange;let f="";f=0<v&&0<g?g<v?parseFloat(v/g).toFixed(2)+":1":"1:"+parseFloat(g/v).toFixed(2):v<0&&g<0?g<v?f="1:"+parseFloat(-1*g/(-1*v)).toFixed(2):parseFloat(-1*v/(-1*g)).toFixed(2)+":1":"∞",e.find(".chips-hawa-oi-ratio").length?e.find(".chips-hawa-oi-ratio").text(f):e.append(`<div class='chips-hawa-oi-ratio'>${f}</div>`),parseFloat(u)<parseFloat(x)&&(P[0]=i+1,P[1]=i+2),SHOW_LTP&&0==r.find("button").length&&(w=$("<button>",{class:"chips-hawa-ltp-trigger",text:"LTP","data-strikeCol":m.strikeCol,"data-type":"CALL"}).on("click",ltpCalculatorUI),r.append(w)),SHOW_LTP&&0==o.find("button").length&&(w=$("<button>",{class:"chips-hawa-ltp-trigger",text:"LTP","data-strikecol":m.strikeCol,"data-type":"PUT"}).on("click",ltpCalculatorUI),o.append(w))}),P[0]=strikePriceOrder[P[0]],P[1]=strikePriceOrder[P[1]],$(".chips-hawa-highlight-cell").removeClass("chips-hawa-highlight-cell"),$(".chips-hawa-highlight-int-cell").removeClass("chips-hawa-highlight-int-cell"),$(".chips-hawa-imaginary-line").removeClass("chips-hawa-imaginary-line");var c,p,s=optionChainPrice[P[1]+"-CALL"].index;$(`#oc-table-body div.rt-tr-group:nth-child(${s})`).addClass("chips-hawa-imaginary-line");let i=(c=P[0])+"-CALL",t=i,a=i,e=i;for(;optionChainPrice[t].volume<optionChainPrice[i].volume&&(t=i),optionChainPrice[a].oi<optionChainPrice[i].oi&&(a=i),optionChainPrice[e].oiChange<optionChainPrice[i].oiChange&&(e=i),c=strikePriceOrder[optionChainPrice[i].index+1],i=c+"-CALL",optionChainPrice[i];);highlightCell(optionChainPrice[t].index,m.callVolume),highlightCell(optionChainPrice[a].index,m.callOICol),highlightCell(optionChainPrice[e].index,m.callOIChange,"chips-hawa-highlight-int-cell");let r=(p=P[1])+"-PUT",o=r,n=r,l=r;for(;optionChainPrice[o].volume<optionChainPrice[r].volume&&(o=r),optionChainPrice[n].oi<optionChainPrice[r].oi&&(n=r),optionChainPrice[l].oiChange<optionChainPrice[r].oiChange&&(l=r),p=strikePriceOrder[optionChainPrice[r].index-1],r=p+"-PUT",optionChainPrice[r];);highlightCell(optionChainPrice[o].index,m.putVolume),highlightCell(optionChainPrice[n].index,m.putOICol),highlightCell(optionChainPrice[l].index,m.putOIChange,"chips-hawa-highlight-int-cell")}else 0==$(".chips-hawa-error").length&&$("body").append(`
				<div class="chips-hawa-error">
					<p>Please enable Volume,OI-Change and Delta column from the settings</p>
				</div>`)}}function getElementPosition(i){var t=i[0].getBoundingClientRect().left+$(window).scrollLeft(),a=i[0].getBoundingClientRect().right+$(window).scrollLeft();return[t,i[0].getBoundingClientRect().top+$(window).scrollTop(),a,i[0].getBoundingClientRect().bottom+$(window).scrollTop()]}function main(){initMenuBar(),setInterval(()=>{try{"chips"===viewMode?updateChipsHawa():"ltp"===viewMode&&updateLTP()}catch(i){console.error(i)}},1200)}main();