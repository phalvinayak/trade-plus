let RESP_OBJ=JSON.parse('{"sEcho":1,"iTotalRecords":21,"iTotalDisplayRecords":21,"aaData":[["-","-","31-Oct-2022_15:30:00","0.9364","-0.3543","0.0008","0.9433","-","0.00",0,"0.00","0.00","-","0.00",null,null,null,"2980","6.95","14.55","9.17","8.65","-4.25","12000.00","8400.00",5400,"21.99","0.50","-0.0542","0.0007","-0.3370","0.9036","-","-","31-Oct-2022_15:30:00","Bullish","SB"],["SC","Bullish","31-Oct-2022_15:30:00","1.1634","-0.4402","0.0009","0.9250","0.28","22.46",-1050,"59100.00","28350.00","21.70","211.00","214.88","205.95","212.70","3000","10.00","10.20","10.80","10.20","-5.05","216900.00","304950.00",49200,"21.46","0.56","-0.0722","0.0009","-0.4213","1.1298","5.16","7.65","31-Oct-2022_15:30:00","Bullish","SB"],["-","-","31-Oct-2022_15:30:00","1.4142","-0.5350","0.0012","0.9026","-","0.00",0,"0.00","0.00","-","0.00",null,null,null,"3020","5.45","17.45","12.52","11.60","-6.30","82800.00","51750.00",36000,"20.68","0.13","-0.0943","0.0011","-0.5150","1.3810","-","-","31-Oct-2022_15:30:00","Bullish","SB"],["LB","Bullish","31-Oct-2022_15:30:00","1.6826","-0.6366","0.0014","0.8759","0.46","21.32",150,"750.00","300.00","20.90","175.25","175.25","166.00","179.70","3040","12.70","14.65","15.02","14.10","-7.10","42750.00","18150.00",1500,"20.33","0.16","-0.1208","0.0014","-0.6158","1.6513","24.20","142.50","31-Oct-2022_15:30:00","Bullish","SB"],["LB","Bullish","31-Oct-2022_15:30:00","1.9602","-0.7416","0.0016","0.8447","0.20","21.61",150,"1350.00","750.00","18.90","159.90","162.16","144.25","167.40","3060","10.45","17.95","17.62","16.65","-8.55","47850.00","24750.00",2700,"19.79","0.07","-0.1519","0.0016","-0.7206","1.9322","18.33","63.80","31-Oct-2022_15:30:00","Bullish","SB"],["-","-","31-Oct-2022_15:30:00","2.2370","-0.8463","0.0018","0.8090","1.80","23.55",0,"6150.00","300.00","21.65","149.65","149.65","126.20","150.35","3080","13.30","22.85","20.67","19.70","-10.20","45600.00","22200.00",4650,"19.27","-0.25","-0.1877","0.0018","-0.8254","2.2134","3.61","152.00","31-Oct-2022_15:30:00","Bullish","SB"],["SC","Bullish","31-Oct-2022_15:30:00","2.5017","-0.9465","0.0020","0.7689","0.08","19.33",-18600,"89100.00","208050.00","15.35","124.00","128.20","124.00","126.00","3100","23.20","24.80","25.22","24.00","-11.40","346200.00","223650.00",18150,"19.01","-0.15","-0.2281","0.0021","-0.9261","2.4833","2.51","1.66","31-Oct-2022_15:30:00","Bullish","SB"],["SC","Bullish","31-Oct-2022_15:30:00","2.7428","-1.0377","0.0022","0.7248","-0.02","19.36",-600,"6600.00","1500.00","15.05","109.95","112.58","102.15","113.10","3120","21.15","29.90","30.36","29.00","-12.70","73050.00","20400.00",-2100,"18.73","-0.11","-0.2725","0.0023","-1.0179","2.7297","3.09","48.70","31-Oct-2022_15:30:00","Bullish","LU"],["SC","Bullish","31-Oct-2022_15:30:00","2.9491","-1.1158","0.0024","0.6772","1.44","19.75",-4950,"25350.00","37500.00","15.45","97.90","99.62","94.00","101.95","3140","34.05","35.95","35.97","34.65","-14.40","139500.00","36750.00",-12450,"18.39","0.59","-0.3206","0.0024","-1.0967","2.9409","1.45","3.72","31-Oct-2022_15:30:00","Bullish","LU"],["SC","Bullish","31-Oct-2022_15:30:00","3.1109","-1.1770","0.0025","0.6269","0.37","18.70",-22200,"46500.00","130050.00","11.40","82.40","86.86","81.50","83.60","3160","41.50","41.90","42.54","41.50","-15.95","164550.00","77850.00",5100,"18.15","-0.37","-0.3716","0.0026","-1.1586","3.1069","1.67","1.27","31-Oct-2022_15:30:00","Bullish","SB"],["SC","Bullish","31-Oct-2022_15:30:00","3.2207","-1.2185","0.0026","0.5746","-0.89","17.80",-12900,"49050.00","186000.00","7.55","68.15","74.28","68.15","71.00","3180","48.55","50.00","50.70","48.60","-18.20","219450.00","61950.00",47400,"17.68","-0.40","-0.4246","0.0027","-1.2006","3.2194","1.26","1.18","31-Oct-2022_15:30:00","Bullish","SB"],["LB","Bullish","31-Oct-2022_15:30:00","3.2735","-1.2385","0.0027","0.5213","-0.20","18.16",11700,"424500.00","1325850.00","8.00","59.00","63.72","59.00","60.20","3200","58.00","59.00","59.20","59.00","-18.20","452250.00","205050.00",21300,"17.90","0.03","-0.4786","0.0027","-1.2207","3.2735","0.48","0.34","31-Oct-2022_15:30:00","Bullish","SB"],["LB","Bullish","31-Oct-2022_15:30:00","3.2676","-1.2362","0.0027","0.4680","-0.01","18.20",13200,"42150.00","181800.00","7.35","49.90","52.95","49.05","53.60","3220",null,null,null,"0.00","-","0.00","0.00",0,"0.00","-","-0.5327","0.0027","-1.2184","3.2671","-","-","31-Oct-2022_15:30:00","-","-"],["LB","Bullish","31-Oct-2022_15:30:00","3.2044","-1.2123","0.0026","0.4155","-0.31","17.96",1050,"40200.00","154800.00","5.30","40.95","44.28","41.00","42.45","3240","77.75","85.00","79.83","75.60","-24.40","600.00","1050.00",150,"15.99","-1.04","-0.5859","0.0026","-1.1940","3.2018","0.03","0.00","31-Oct-2022_15:30:00","Bullish","SB"],["LB","Bullish","31-Oct-2022_15:30:00","3.0883","-1.1684","0.0025","0.3649","-0.10","17.99",21450,"77700.00","167250.00","4.75","33.90","36.59","33.25","37.50","3260","88.65","100.40","92.65","91.00","-27.05","450.00","3300.00",300,"16.75","-1.58","-0.6373","0.0026","-1.1494","3.0822","0.04","0.00","31-Oct-2022_15:30:00","Bullish","SB"],["LB","Bullish","31-Oct-2022_15:30:00","2.9259","-1.1070","0.0024","0.3168","-0.40","17.92",12150,"44850.00","120450.00","3.65","27.50","29.85","27.30","30.20","3280","100.85","128.95","-","127.00","-","0.00","150.00",0,"24.20","8.04","-0.6859","0.0024","-1.0871","2.9153","0.00","-","31-Oct-2022_15:30:00","-","-"],["LB","Bullish","31-Oct-2022_15:30:00","2.7260","-1.0313","0.0022","0.2718","-0.03","18.21",37950,"485550.00","576750.00","3.50","23.00","24.68","22.25","23.25","3300","118.55","122.00","118.57","121.00","-23.90","25950.00","161100.00",-5850,"17.13","0.06","-0.7313","0.0022","-1.0107","2.7102","0.33","0.04","31-Oct-2022_15:30:00","Bullish","LU"],["LB","Bullish","31-Oct-2022_15:30:00","2.4983","-0.9452","0.0020","0.2305","0.03","18.28",3000,"29850.00","51600.00","2.95","18.65","19.85","17.15","20.00","3320","123.05","158.70","131.50","136.00","-21.05","300.00","3750.00",150,"16.80","1.61","-0.7729","0.0020","-0.9238","2.4773","0.13","0.01","31-Oct-2022_15:30:00","Bullish","SB"],["LB","Bullish","31-Oct-2022_15:30:00","2.2529","-0.8524","0.0018","0.1932","-0.17","18.07",20250,"52800.00","88800.00","1.75","14.40","15.82","13.10","16.00","3340",null,null,null,"0.00","-","0.00","0.00",0,"0.00","-","-0.8104","0.0018","-0.8305","2.2270","-","-","31-Oct-2022_15:30:00","-","-"],["LB","Bullish","31-Oct-2022_15:30:00","1.9997","-0.7565","0.0016","0.1600","-0.12","18.33",6000,"28650.00","46050.00","1.70","11.80","13.02","10.65","13.95","3360",null,null,null,"0.00","-","0.00","0.00",0,"0.00","-","-0.8436","0.0016","-0.7345","1.9696","-","-","31-Oct-2022_15:30:00","-","-"],["LB","Bullish","31-Oct-2022_15:30:00","1.7474","-0.6611","0.0014","0.1310","0.06","18.61",3150,"22800.00","51600.00","1.55","9.70","10.28","8.65","11.00","3380",null,null,null,"0.00","-","0.00","0.00",0,"0.00","-","-0.8726","0.0014","-0.6393","1.7142","-","-","31-Oct-2022_15:30:00","-","-"]],"strikePriceATM":3180,"futuresPriceStr":"TCS-24NOV22 Futures Closing Price: <b>3,201.25</b> (As of 31-Oct-2022 15:30)","symbol_1":"TCS","optExpDate":"24NOV22","monthlyExpDate":"24NOV22","dt":"2022-10-31","futuresClosingPrice":"3,201.25","TimeStamp":"31-Oct-2022 15:30","futures_close_chg":"28.35","futures_close_chg_percent":"0.89","maxcalloi":"485550.00","mincalloi":"750.00","maxputoi":"304950.00","minputoi":"150.00","maxoichangecall":37950,"minoichangecall":-22200,"maxoichangeput":49200,"minoichangeput":-12450,"maxcallvol":"1325850.00","maxputvol":"452250.00","total_call_oi":1533000,"total_put_oi":1225200,"total_call_oi_change":69900,"total_put_oi_change":171600,"total_call_volume":3357750,"total_put_volume":1870200,"diffoichange":101700,"lot_size":"150","defaultDatedMY":"31-Oct-2022"}'),OC_DIRECTION_OUTPUT={RELIANCE:{positional:-1,intraDay:-1},HDFCBANK:{positional:-1,intraDay:1},ICICIBANK:{positional:-1,intraDay:1},INFY:{positional:-1,intraDay:1},HDFC:{positional:-1,intraDay:1},TCS:{positional:-1,intraDay:1},ITC:{positional:-1,intraDay:-1},KOTAKBANK:{positional:-1,intraDay:1},HINDUNILVR:{positional:-1,intraDay:1},LT:{positional:-1,intraDay:1},SBIN:{positional:-1,intraDay:-1},BHARTIARTL:{positional:-1,intraDay:-1},BAJFINANCE:{positional:-1,intraDay:-1},AXISBANK:{positional:-1,intraDay:-1},ASIANPAINT:{positional:-1,intraDay:1},"M&M":{positional:-1,intraDay:-1},MARUTI:{positional:-1,intraDay:-1},TITAN:{positional:-1,intraDay:-1},SUNPHARMA:{positional:-1,intraDay:-1},BAJAJFINSV:{positional:-1,intraDay:-1},HCLTECH:{positional:-1,intraDay:1},ADANIENT:{positional:-1,intraDay:-1},TATASTEEL:{positional:-1,intraDay:-1},INDUSINDBK:{positional:-1,intraDay:-1},NTPC:{positional:-1,intraDay:-1},TATAMOTORS:{positional:-1,intraDay:-1},POWERGRID:{positional:-1,intraDay:1},ULTRACEMCO:{positional:-1,intraDay:-1},NESTLEIND:{positional:-1,intraDay:-1},TECHM:{positional:-1,intraDay:-1},GRASIM:{positional:-1,intraDay:-1},CIPLA:{positional:-1,intraDay:-1},JSWSTEEL:{positional:-1,intraDay:-1},ADANIPORTS:{positional:-1,intraDay:-1},WIPRO:{positional:-1,intraDay:1},HINDALCO:{positional:-1,intraDay:-1},SBILIFE:{positional:-1,intraDay:-1},DRREDDY:{positional:-1,intraDay:-1},EICHERMOT:{positional:-1,intraDay:1},HDFCLIFE:{positional:-1,intraDay:-1},ONGC:{positional:-1,intraDay:1},TATACONSUM:{positional:-1,intraDay:-1},DIVISLAB:{positional:-1,intraDay:-1},"BAJAJ-AUTO":{positional:-1,intraDay:-1},BRITANNIA:{positional:-1,intraDay:1},COALINDIA:{positional:-1,intraDay:1},APPOLOHOSP:{positional:-1,intraDay:-1},UPL:{positional:-1,intraDay:1},HEROMOTOCO:{positional:-1,intraDay:1},BPCL:{positional:-1,intraDay:-1},AUBANK:{positional:-1,intraDay:1},BANKBARODA:{positional:-1,intraDay:1},FEDERALBNK:{positional:1,intraDay:-1},BANDHANBNK:{positional:-1,intraDay:-1},IDFCFIRSTB:{positional:-1,intraDay:-1},PNB:{positional:-1,intraDay:1}};const STRIKES_FROM_ATM=4,COL_MAP={CALL_OI_CHANGE:9,CE_DELTA:6,CE_THETA:4,CALL_OI:10,STRIKE_PRICE:17,CE_VWAP:14,PE_VWAP:20,PUT_OI:24,PUT_OI_CHANGE:25,CE_LTP:13,PE_LTP:21,PE_DELTA:28,PE_THETA:30,OI_PCR:32},NIFTY50={RELIANCE:"10.84",HDFCBANK:"8.27",ICICIBANK:"7.94",INFY:"6.84",HDFC:"5.48",TCS:"4.07",ITC:"3.86",KOTAKBANK:"3.53",HINDUNILVR:"3.18",LT:"2.95",SBIN:"2.69",BHARTIARTL:"2.59",BAJFINANCE:"2.58",AXISBANK:"2.56",ASIANPAINT:"1.99","M&M":"1.60",MARUTI:"1.55",TITAN:"1.44",SUNPHARMA:"1.35",BAJAJFINSV:"1.34",HCLTECH:"1.30",ADANIENT:"1.25",TATASTEEL:"1.06",INDUSINDBK:"1.02",NTPC:"1.00",TATAMOTORS:"0.96",POWERGRID:"0.96",ULTRACEMCO:"0.95",NESTLEIND:"0.90",TECHM:"0.84",GRASIM:"0.83",CIPLA:"0.80",JSWSTEEL:"0.79",ADANIPORTS:"0.78",WIPRO:"0.77",HINDALCO:"0.75",SBILIFE:"0.74",DRREDDY:"0.70",EICHERMOT:"0.68",HDFCLIFE:"0.66",ONGC:"0.65",TATACONSUM:"0.64",DIVISLAB:"0.62","BAJAJ-AUTO":"0.60",BRITANNIA:"0.60",COALINDIA:"0.59",APPOLOHOSP:"0.59",UPL:"0.47",HEROMOTOCO:"0.44",BPCL:"0.38"},BNF={HDFCBANK:"26.00",ICICIBANK:"24.97",KOTAKBANK:"11.11",AXISBANK:"10.93",SBIN:"10.87",INDUSINDBK:"6.17",AUBANK:"2.34",BANKBARODA:"1.97",FEDERALBNK:"1.90",BANDHANBNK:"1.61",IDFCFIRSTB:"1.24",PNB:"0.87"};async function getIOData(t){return RESP_OBJ}async function initAnalysis(){let t={};var i=new Set(Object.keys(NIFTY50).concat(Object.keys(BNF))).size;for(stox in console.log("Total Count",i),NIFTY50)t.TCS||(t.TCS=await analyseOptionChain(stox));for(stox in BNF)t.TCS||(t[stox]=await analyseOptionChain(stox));console.log(t);let o={idWeight:0,posWeight:0,idUpCount:0,idDownCount:0,posUpCount:0,posDownCount:0},a=0,l=0,n="";for(stox in NIFTY50){var s=getNumber(NIFTY50[stox]);o.idWeight+=OC_DIRECTION_OUTPUT[stox].intraDay*s,o.posWeight+=OC_DIRECTION_OUTPUT[stox].positional*s,1==OC_DIRECTION_OUTPUT[stox].intraDay?o.idUpCount++:o.idDownCount++,1==OC_DIRECTION_OUTPUT[stox].positional?o.posUpCount++:o.posDownCount++,a+=OC_DIRECTION_OUTPUT[stox].intraDay*s,l+=OC_DIRECTION_OUTPUT[stox].positional*s,n+=`<tr>
            <td>${stox}</td><td>${1==OC_DIRECTION_OUTPUT[stox].intraDay?"🟢":"🔻"}(${s})</td>
            <td>${stox}</td><td>${1==OC_DIRECTION_OUTPUT[stox].positional?"🟢":"🔻"}(${s})</td>
        </tr>`}console.log(parseFloat(a).toFixed(2),parseFloat(l).toFixed(2)),console.log(parseFloat(o.idWeight).toFixed(2),parseFloat(o.posWeight).toFixed(2)),console.log(o.idUpCount,o.idDownCount,o.posUpCount,o.posDownCount);let O={idWeight:0,posWeight:0,idUpCount:0,idDownCount:0,posUpCount:0,posDownCount:0},T=0,C=0,D="";for(stox in BNF){var I=getNumber(BNF[stox]);O.idWeight+=OC_DIRECTION_OUTPUT[stox].intraDay*I,O.posWeight+=OC_DIRECTION_OUTPUT[stox].positional*I,1==OC_DIRECTION_OUTPUT[stox].intraDay?O.idUpCount++:O.idDownCount++,1==OC_DIRECTION_OUTPUT[stox].positional?O.posUpCount++:O.posDownCount++,T+=OC_DIRECTION_OUTPUT[stox].intraDay*I,C+=OC_DIRECTION_OUTPUT[stox].positional*I,console.log(stox,OC_DIRECTION_OUTPUT[stox].intraDay,I),D+=`<tr>
            <td>${stox}</td><td>${1==OC_DIRECTION_OUTPUT[stox].intraDay?"🟢":"🔻"}(${I})</td>
            <td>${stox}</td><td>${1==OC_DIRECTION_OUTPUT[stox].positional?"🟢":"🔻"}(${I})</td>
        </tr>`}console.log(parseFloat(T).toFixed(2),parseFloat(C).toFixed(2)),console.log(parseFloat(O.idWeight).toFixed(2),parseFloat(O.posWeight).toFixed(2)),console.log(O.idUpCount,O.idDownCount,O.posUpCount,O.posDownCount),console.log(D)}async function analyseOptionChain(t){t=await getIOData(t);let i=t.aaData,o=parseFloat(t.strikePriceATM).toFixed(2);var a=i.findIndex(t=>parseFloat(t[COL_MAP.STRIKE_PRICE]).toFixed(2)==o);let l=0,n=0,s=0,O=0;for(let t=a-1;t<=a+STRIKES_FROM_ATM;t++)i[t]&&(l+=getNumber(i[t][COL_MAP.CALL_OI]),s+=getNumber(i[t][COL_MAP.CALL_OI_CHANGE]));for(let t=a-STRIKES_FROM_ATM;t<=a+1;t++)i[t]&&(n+=getNumber(i[t][COL_MAP.PUT_OI]),O+=getNumber(i[t][COL_MAP.PUT_OI_CHANGE]));console.log(l,n,s,O);let T="∞";0<l&&(T=parseFloat(n/l).toFixed(2));let C="∞";return 0<s&&(C=parseFloat(O/calcallOIChgSumlOISum).toFixed(2)),{positional:n>l?1:-1,positionalPCR:T,intraDay:O>s?1:-1,intraDayPCR:C}}function getNumber(t){return isNumeric(""+t)?Number(t):0}function isNumeric(t){return"string"==typeof t&&(!isNaN(t)&&!isNaN(parseFloat(t)))}async function main(){await initAnalysis()}main();